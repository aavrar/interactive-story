# Interactive Storytelling Engine - End Goal Vision

## Core Idea

The interactive storytelling engine should leverage AI/ML to create a dynamic and personalized narrative experience for the user, where their choices and character backstory significantly impact the gameplay and outcome.

## Key Features

### 1. Emotion-Based Narrative Adaptation (ML-1)
* The system analyzes player input to classify emotional tone (e.g., fear, joy, sadness) using a pre-trained NLP model.
* The game dynamically adjusts narrative paths or responses based on detected emotion.
* **Current Implementation**: This is a new feature. It would require:
  - [ ] **1.1** Install and integrate a HuggingFace emotion classifier (e.g., `distilroberta-base-emotion`) (ML-1.1)
  - [ ] **1.2** Build a function to classify emotions from input text (ML-1.2)
  - [ ] **1.3** Modify `StoryEngine.process_command()` to log emotions and respond accordingly (ML-1.3)
  - [ ] **1.4** Add emotion logging to the `GameState` object (ML-1.4)
  - [ ] **1.5** Add `/emotion` API endpoint (optional for web use) (ML-1.5)

---

### 2. ML-Powered Branch Prediction (ML-2)
* The system learns from player histories to predict or recommend the most likely next scene or choice.
* Useful for "suggest next move" features or adaptive pacing.
* **Current Implementation**: This is a new feature. It would require:
  - [ ] **2.1** Define training data structure (e.g., sequences of choices â†’ next scene) (ML-2.1)
  - [ ] **2.2** Use `CountVectorizer` + `RandomForestClassifier` to train a model (ML-2.2)
  - [ ] **2.3** Create a `suggest_next_scene()` function (ML-2.3)
  - [ ] **2.4** Integrate suggestions into gameplay or expose via `/suggest` endpoint (ML-2.4)
  - [ ] **2.5** Optionally log new game sessions to expand training data (ML-2.5)

---

### 3. Game State Logging for ML (ML-3)
* Player inputs, emotional trends, and decisions are logged and structured to enable long-term personalization or retraining.
* **Current Implementation**: Partial (command history may exist). Extend with:
  - [ ] **3.1** Extend `GameState` to include `emotion_log`, `scene_log`, and `suggestion_log` fields (ML-3.1)
  - [ ] **3.2** Add a log writer (e.g., JSON or SQLite-based) to persist this state (ML-3.2)
  - [ ] **3.3** Create a `/save_log` endpoint (optional) (ML-3.3)

---

### 4. Modular ML Integration Layer (ML-4)
* Organize all ML functionality in a reusable, testable structure to keep logic clean.
* **Current Implementation**: Not yet structured. To implement:
  - [ ] **4.1** Create a `utils/emotion.py` module with the classification logic (ML-4.1)
  - [ ] **4.2** Create a `ml/branch_predictor.py` module for training + inference (ML-4.2)
  - [ ] **4.3** Create a `ml/logging.py` or `analytics.py` for behavior tracking (ML-4.3)

### 1. Procedural Backstory Generation (END-1)
    *   The system ingests the user's personal writing and reference pieces about the narrative.
    *   An AI/ML model analyzes this input to generate a coherent and relevant backstory for the app's world and setting.
    *   **Current Implementation**: This is a new feature. It would require:
        *   [ ] 1.1 Integrate an AI/ML model (e.g., using a library like Transformers) (END-1.1)
        *   [ ] 1.2 Process the input text (END-1.2)
        *   [ ] 1.3 Generate the backstory (END-1.3)

### 2. Character Backstory Input (END-2)
    *   The user provides a backstory for their character.
    *   This can be done through:
        *   A selection of 2-3 backstories generated by the AI/ML model.
        *   An option for the user to input a custom backstory.
    *   **Current Implementation**: Currently, there is no character backstory input. This would require:
        *   [ ] 2.1 Add a UI element (in the frontend) to present the backstory choices (END-2.1)
        *   [ ] 2.2 Allow custom input (END-2.2)
        *   [ ] 2.3 Pass the selected backstory to the backend (END-2.3)

### 3. Personalized Starting Inventory (END-3)
    *   Based on the chosen or custom character backstory, the character starts the game with a set of items that are relevant to their background and skills.
    *   This "character build" influences the initial gameplay and available options.
    *   **Current Implementation**: The starting inventory is currently fixed. This would require:
        *   [ ] 3.1 Modify the `StoryEngine` to initialize the `game_state.inventory` based on the selected character backstory (END-3.1)
        *   [ ] 3.2 Create a mapping between backstories and starting items (END-3.2)

### 4. Dynamic Narrative Branching (END-4)
    *   Each character backstory leads to a specific starting point in the game world.
    *   The player's journey and available choices are heavily influenced by their backstory.
    *   Choices made when interacting with items, characters, and the environment have meaningful consequences.
    *   **Current Implementation**: The starting point is fixed, and the narrative branching is limited. This would require:
        *   [ ] 4.1 Modify the `StoryEngine` to start the game at a different scene based on the character backstory (END-4.1)
        *   [ ] 4.2 Expand the `story.json` file to include more choices and consequences that are dependent on the backstory (END-4.2)
        *   [ ] 4.3 Potentially use the AI/ML model to dynamically generate choices and consequences based on the backstory and player actions (END-4.3)

### 5. Multiple Endings (END-5)
    *   The story's ending is not predetermined but emerges based on the player's choices and actions throughout the game.
    *   Different paths and decisions lead to different outcomes, providing a unique and replayable experience.
    *   **Current Implementation**: The game currently lacks a defined ending. This would require:
        *   [ ] 5.1 Defining multiple ending scenes in the `story.json` file (END-5.1)
        *   [ ] 5.2 Modifying the `StoryEngine` to track the player's choices and actions and guide them towards the appropriate ending based on their decisions (END-5.2)
        *   [ ] 5.3 Potentially using the AI/ML model to dynamically generate ending scenes based on the player's overall journey (END-5.3)
